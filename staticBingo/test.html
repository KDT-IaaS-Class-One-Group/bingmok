<!DOCTYPE html>
<html>
<head>
    <style>
        /* CSS 스타일링은 여기에 작성합니다. */
        .bingo-container {
            display: flex;
            justify-content: space-between;
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 5px;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border: 1px solid #000;
            font-size: 20px;
            cursor: pointer;
        }

        .timer {
            text-align: center;
            font-size: 20px;
        }

        .turn-message {
            text-align: center;
            font-size: 20px;
        }

        .next-turn-button {
            text-align: center;
            font-size: 20px;
            cursor: pointer;
        }

        .bingo {
            background-color: lightgreen;
        }

        .right-board-blur {
            filter: blur(3px);
        }
    </style>
</head>
<body>
    <div class="bingo-container">
        <div class="bingo-board" id="left-board"></div>
        <div class="bingo-board right-board-blur" id="right-board"></div>
    </div>
    <div class="timer">5</div>
    <div class="turn-message" id="turn-message"></div>
    <div class="next-turn-button" id="next-turn-button" style="display: none">다음 차례</div>
    <div class="game-reset-button" id="game-reset-button">게임 리셋</div>

    <script>
        const leftBoard = document.getElementById("left-board");
        const rightBoard = document.getElementById("right-board");
        const turnMessage = document.getElementById("turn-message");
        const nextTurnButton = document.getElementById("next-turn-button");
        const gameResetButton = document.getElementById("game-reset-button");

        const boards = [leftBoard, rightBoard];
        const players = ["왼쪽", "오른쪽"];
        let currentPlayer = 0;
        let timer = 5;
        let interval;
        let leftBoardNumbers = [];
        let rightBoardNumbers = [];
        let horizontalLinesToWin = 2;
        let verticalLinesToWin = 2;
        let winner = null;
        let leftBoardClicked = false; // 왼쪽 보드에서 클릭 상태 저장

        initializeGame();

        gameResetButton.addEventListener("click", resetGame);

        function initializeGame() {
            createBingoBoard(leftBoard);
            createBingoBoard(rightBoard);

            startTimer();

            displayTurnMessage();

            nextTurnButton.addEventListener("click", nextTurn);
        }

        function createBingoBoard(board) {
            board.innerHTML = "";
            const numbers = generateRandomNumbers(1, 25);

            for (let i = 0; i < 25; i++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.textContent = numbers[i];
                cell.addEventListener("click", () => cellClickHandler(cell, board));
                board.appendChild(cell);

                if (board === leftBoard) {
                    leftBoardNumbers.push(numbers[i]);
                } else {
                    rightBoardNumbers.push(numbers[i]);
                }
            }
        }

        function generateRandomNumbers(min, max) {
            const numbers = [];
            for (let i = min; i <= max; i++) {
                numbers.push(i);
            }
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            return numbers;
        }

        function cellClickHandler(cell, board) {
            if (cell.textContent === "X" || cell.parentElement !== leftBoard) {
                return;
            }

            const selectedNumber = cell.textContent;

            // 왼쪽 빙고판에서 클릭하면 다른 셀이 자동으로 클릭되는 것을 막음
            leftBoardClicked = true;

            cell.textContent = "X";
            cell.style.backgroundColor = "lightgray";
            cell.style.pointerEvents = "none"; // 클릭 방지

            markRightBoard(selectedNumber);
            markLeftBoard(selectedNumber);

            if (checkWin(leftBoard) || checkWin(rightBoard)) {
                showWinnerMessage(winner);
                clearInterval(interval);
            } else {
                showNextTurnButton();

                if (currentPlayer === 0) {
                    moveNextCell();
                }
            }
        }

        function moveNextCell() {
            if (leftBoardClicked) {
                // 왼쪽 보드에서 클릭이 발생한 경우, 오른쪽 보드에 클릭 이벤트를 발생시키지 않음
                leftBoardClicked = false;
                return;
            }

            const rightCells = rightBoard.getElementsByClassName("cell");
            for (let i = 0; i < rightCells.length; i++) {
                const cell = rightCells[i];
                if (cell.textContent === "X") {
                    continue;
                }
                const selectedNumber = cell.textContent;
                cellClickHandler(cell, rightBoard);
                markLeftBoard(selectedNumber);
                break;
            }
        }

        function markRightBoard(selectedNumber) {
            const rightCells = rightBoard.getElementsByClassName("cell");
            for (let i = 0; i < rightCells.length; i++) {
                const cell = rightCells[i];
                if (cell.textContent === selectedNumber) {
                    cell.textContent = "X";
                    cell.style.backgroundColor = "lightgray";
                    cell.style.pointerEvents = "none"; // 클릭 방지
                }
            }
        }

        function markLeftBoard(selectedNumber) {
            const leftCells = leftBoard.getElementsByClassName("cell");
            for (let i = 0; i < leftCells.length; i++) {
                const cell = leftCells[i];
                if (cell.textContent === selectedNumber) {
                    cell.textContent = "X";
                    cell.style.backgroundColor = "lightgray";
                    cell.style.pointerEvents = "none"; // 클릭 방지
                }
            }
        }

        function nextTurn() {
            currentPlayer = 1 - currentPlayer;
            hideNextTurnButton();
            displayTurnMessage();
            resetTimer();
            if (currentPlayer === 1) {
                enableRightBoard();
            }
        }

        function displayTurnMessage() {
            turnMessage.textContent = `차례입니다 (${players[currentPlayer]})`;
        }

        function startTimer() {
            clearInterval(interval);
            timer = 5;
            interval = setInterval(() => {
                document.querySelector(".timer").textContent = timer;
                if (timer <= 0) {
                    nextTurn();
                }
                timer--;
            }, 1000);
        }

        function resetTimer() {
            clearInterval(interval);
            startTimer();
        }

        function checkWin(board) {
            const cells = board.getElementsByClassName("cell");
            const lines = [
                [0, 1, 2, 3, 4],
                [5, 6, 7, 8, 9],
                [10, 11, 12, 13, 14],
                [15, 16, 17, 18, 19],
                [20, 21, 22, 23, 24],
                [0, 5, 10, 15, 20],
                [1, 6, 11, 16, 21],
                [2, 7, 12, 17, 22],
                [3, 8, 13, 18, 23],
                [4, 9, 14, 19, 24],
                [0, 6, 12, 18, 24],
                [4, 8, 12, 16, 20]
            ];

            let linesCompleted = 0;
            for (const line of lines) {
                if (line.every(index => cells[index].textContent === "X")) {
                    linesCompleted++;
                }
            }

            if (linesCompleted >= 2) {
                winner = board;
                return true;
            }

            return false;
        }

        function showNextTurnButton() {
            nextTurnButton.style.display = "block";
        }

        function hideNextTurnButton() {
            nextTurnButton.style.display = "none";
        }

        function showWinnerMessage(winner) {
            if (winner === leftBoard) {
                alert("왼쪽 빙고판이 이겼습니다");
            } else if (winner === rightBoard) {
                alert("오른쪽 빙고판이 이겼습니다");
            }
        }

        function enableRightBoard() {
            const rightCells = rightBoard.getElementsByClassName("cell");
            for (let i = 0; i < rightCells.length; i++) {
                const cell = rightCells[i];
                if (cell.textContent === "X") {
                    continue;
                }
                cell.style.pointerEvents = "auto";
            }
        }

        function resetGame() {
            boards.forEach(board => {
                board.classList.remove("bingo");
                board.classList.remove("right-board-blur");
            });
            winner = null;
            horizontalLinesToWin = 2;
            verticalLinesToWin = 2;
            leftBoardNumbers = [];
            rightBoardNumbers = [];
            createBingoBoard(leftBoard);
            createBingoBoard(rightBoard);
            clearInterval(interval);
            timer = 5;
            startTimer();
            hideNextTurnButton();
            displayTurnMessage();
            currentPlayer = 0;
            enableRightBoard();
            rightBoard.classList.add("right-board-blur");
        }
    </script>
</body>
</html>
